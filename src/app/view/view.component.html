<div class="container-fluid" style="padding-left: 0px">
  <div class="col-sm-2" style="padding-left: 0px">
    <img src="icon.png"> <span style="font-size: 15px"> Score Card</span>
  </div>
  <div class="col-sm-8">
    <h3 class="text-center" style="margin-top: 0px"><small></small></h3>
  </div>
  <div class="col-sm-2" style="margin-top: 14px">
    <button class="btn btn-default btn-sm pull-right" [routerLink]="['']"><span class="glyphicon glyphicon-home"></span> home</button>
  </div>
</div>

<div class="container-fluid" id="filters">
  <!--<dhis-org-unit-tree id="middle1" [dhis2_url]="base_url" [tree_config]="tree_config"> </dhis-org-unit-tree>-->
  <app-filter></app-filter>
</div>

<div class="row" *ngIf="loading">
  <!--<img src="loading.gif" style="height: 70px; padding-top: 20px">-->
  {{ loading_message }}

  <div class="progress">
    <div class="progress-bar" role="progressbar" [attr.aria-valuenow]="proccessed_percent" [attr.aria-valuemin]="0" [attr.aria-valuemax]="100" [style.width]="proccessed_percent+'%'">
      {{ proccessed_percent | number : '1.2-2' }}%
    </div>
  </div>
</div>
<div class="container-fluid" id="scorecard">
  <table class="table table-bordered"
         style="margin-bottom: 3px;font-size: 9px;border: 1px solid #ddd;border-spacing: 0;border-collapse: collapse;display: table;"
         *ngIf="!loading">
    <tr>
      <th>

      </th>
      <th
        style="font-size: 9px; "
        *ngFor="let indicator_holder_group of scorecard.data.data_settings.indicator_holder_groups"
        [attr.colspan]="indicator_holder_group.indicator_holder_ids.length"
        class="sans-pro">
        {{ indicator_holder_group.name }}
      </th>
    </tr>
    <tr>
      <th style="vertical-align: bottom">
        <input type="text" class="form-control input-sm" [(ngModel)]="searchQuery" placeholer="Search">
      </th>
      <th *ngFor="let indicator of getItemsFromGroups()" style="font-size: 10px;width: 70px;cursor: pointer" class="sans-pro"
          title="Click to analyse {{ getIndicatorTitle(indicator) }}">
        {{ getIndicatorTitle(indicator) }}
      </th>
    </tr>
    <tr *ngFor="let current_orgunit of orgunits | filterByName:searchQuery" style="height: 35px">
      <td style="vertical-align: bottom;font-size: 10px;">
        {{ current_orgunit.name }}
      </td>
      <td *ngFor="let indicator of getItemsFromGroups()"
          style="font-size: 10px;width: 70px; cursor: pointer; padding: 0px;line-height: 10%" class="sans-pro">
        <svg *ngIf="indicator.indicators.length == 2" viewbox="0 0 70 35" width="70" height="35">
          <polygon points="0 0 70 0 70 0 0 35" [attr.fill]="assignBgColor(indicator.indicators[0],indicator.indicators[0].values[current_orgunit.id])" style="stroke:#CAC0C0;stroke-width:0.4"/>
          <text fill="#000" x="3" y="20" font-size="11" font-family="Source Sans Pro">
            <tspan>{{ indicator.indicators[0].values[current_orgunit.id] }}</tspan>
          </text>
          <!--top arrow-->
          <path ng-if="indicator.indicators[0].showTopArrow[current_orgunit.id]" d="M2,10H12L7,4" style="fill:black;stroke:black;stroke-width:1"/>
          <!--bottom arrow showing decrease-->
          <path ng-if="indicator.indicators[0].showBottomArrow[current_orgunit.id]" d="M2,22H12L7,30" style="fill:black;stroke:black;stroke-width:1"/>

          <!--second triangle-->
          <polygon points="0 35 70 0 70 35 0 35" [attr.fill]="assignBgColor(indicator.indicators[1],indicator.indicators[1].values[current_orgunit.id])" style="stroke:#CAC0C0;stroke-width:0.4"/>
          <!--number for the second triangle-->
          <text fill="#000" x="48" y="20" font-size="11" font-family="Source Sans Pro">
            <tspan>{{ indicator.indicators[1].values[current_orgunit.id] }}</tspan>
          </text>
          <!--top arrow for the right triagle-->
          <path ng-if="indicator.indicators[1].showTopArrow[current_orgunit.id]" d="M65,10H55L60,4" style="fill:black;stroke:black;stroke-width:1"/>
          <!--below arrow for the triangle-->
          <path ng-if="indicator.indicators[1].showBottomArrow[current_orgunit.id]" d="M65,22H55L60,28" style="fill:black;stroke:black;stroke-width:1"/>
        </svg>

        <!--if there is only one indicator to display-->
        <svg *ngIf="indicator.indicators.length == 1" viewbox="0 0 90 35" width="90" height="35">
          <!--full box to cover all area-->
          <polygon points="0 0 90 0 90 35 0 35" [attr.fill]="assignBgColor(indicator.indicators[0],indicator.indicators[0].values[current_orgunit.id])"/>
          <text fill="#000" x="30" y="20" font-size="11" font-family="Source Sans Pro">
            <tspan>{{ indicator.indicators[0].values[current_orgunit.id] }}</tspan>
          </text>
        </svg>
      </td>

    </tr>
  </table>
</div>

